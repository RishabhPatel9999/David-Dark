<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Learning Hub - Advanced AI Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { 
            font-family: 'Inter', sans-serif; 
            box-sizing: border-box;
        }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
        .pulse-dot { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .progress-bar { transition: width 0.5s ease-in-out; }
        .typing-animation { 
            border-right: 2px solid #3b82f6; 
            animation: blink 1s infinite; 
        }
        @keyframes blink { 0%, 50% { border-color: transparent; } 51%, 100% { border-color: #3b82f6; } }
        .floating { animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
        .slide-in { animation: slideIn 0.5s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
        .modal-backdrop { backdrop-filter: blur(8px); }
        .glassmorphism { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2); }
        .neon-glow { box-shadow: 0 0 20px rgba(59, 130, 246, 0.5); }
        .code-editor { font-family: 'Courier New', monospace; background: #1e293b; color: #e2e8f0; }
        .syntax-highlight .keyword { color: #f59e0b; }
        .syntax-highlight .string { color: #10b981; }
        .syntax-highlight .comment { color: #6b7280; }
        .ai-thinking { 
            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #3b82f6);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Advanced Header -->
    <header class="gradient-bg text-white shadow-lg relative overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-r from-blue-600/20 to-purple-600/20"></div>
        <div class="container mx-auto px-6 py-4 relative z-10">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 bg-white rounded-xl flex items-center justify-center floating">
                        <span class="text-2xl">üß†</span>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold">Smart Learning Hub</h1>
                        <p class="text-xs text-white/80">AI-Powered Education Platform</p>
                    </div>
                </div>
                
                <!-- Navigation Menu -->
                <nav class="hidden md:flex items-center space-x-6">
                    <button onclick="showDashboard()" class="nav-item text-sm hover:text-blue-200 transition-colors">Dashboard</button>
                    <button onclick="showAITutor()" class="nav-item text-sm hover:text-blue-200 transition-colors">AI Tutor</button>
                    <button onclick="showCodeLab()" class="nav-item text-sm hover:text-blue-200 transition-colors">Code Lab</button>
                    <button onclick="showAnalytics()" class="nav-item text-sm hover:text-blue-200 transition-colors">Analytics</button>
                    <button onclick="showStudyGroups()" class="nav-item text-sm hover:text-blue-200 transition-colors">Study Groups</button>
                </nav>
                
                <div class="flex items-center space-x-4">
                    <!-- AI Status Indicator -->
                    <div class="flex items-center space-x-2 bg-white/20 rounded-full px-4 py-2 glassmorphism">
                        <div class="w-2 h-2 bg-green-400 rounded-full pulse-dot"></div>
                        <span class="text-sm">AI Online</span>
                    </div>
                    
                    <!-- Notifications -->
                    <button onclick="showNotifications()" class="relative p-2 bg-white/20 rounded-full hover:bg-white/30 transition-colors">
                        <span class="text-lg">üîî</span>
                        <span class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 rounded-full text-xs flex items-center justify-center" id="notification-count">3</span>
                    </button>
                    
                    <!-- User Profile -->
                    <div class="relative">
                        <button onclick="toggleUserMenu()" class="flex items-center space-x-2 bg-white/20 rounded-full px-4 py-2 hover:bg-white/30 transition-colors">
                            <div class="w-8 h-8 bg-gradient-to-r from-blue-400 to-purple-400 rounded-full flex items-center justify-center">
                                <span class="text-sm font-bold" id="user-avatar">A</span>
                            </div>
                            <span class="text-sm" id="user-name-header">Student</span>
                            <span class="text-xs">‚ñº</span>
                        </button>
                        
                        <!-- User Dropdown Menu -->
                        <div id="user-menu" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-lg py-2 z-50">
                            <a href="#" onclick="showProfile()" class="block px-4 py-2 text-gray-800 hover:bg-gray-100 transition-colors">üë§ Profile</a>
                            <a href="#" onclick="showSettings()" class="block px-4 py-2 text-gray-800 hover:bg-gray-100 transition-colors">‚öôÔ∏è Settings</a>
                            <a href="#" onclick="showHelp()" class="block px-4 py-2 text-gray-800 hover:bg-gray-100 transition-colors">‚ùì Help</a>
                            <hr class="my-2">
                            <a href="#" onclick="logout()" class="block px-4 py-2 text-red-600 hover:bg-red-50 transition-colors">üö™ Logout</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content Container -->
    <main class="container mx-auto px-6 py-8" id="main-content">
        <!-- Advanced Welcome Section -->
        <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl shadow-lg p-8 mb-8 relative overflow-hidden">
            <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-blue-200/30 to-purple-200/30 rounded-full -mr-16 -mt-16"></div>
            <div class="relative z-10">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-2" id="welcome-message">Welcome back! üëã</h2>
                        <p class="text-gray-600 mb-4">Ready to continue your AI-powered learning journey?</p>
                        <div class="flex items-center space-x-4">
                            <div class="flex items-center space-x-2 bg-white/60 rounded-full px-4 py-2">
                                <span class="text-sm">üéØ Today's Goal:</span>
                                <span class="font-medium text-sm" id="daily-goal">Complete 2 lessons</span>
                            </div>
                            <div class="flex items-center space-x-2 bg-white/60 rounded-full px-4 py-2">
                                <span class="text-sm">‚ö° XP:</span>
                                <span class="font-medium text-sm" id="user-xp">2,450</span>
                            </div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-4xl font-bold text-blue-600 mb-1" id="streak-counter">7</div>
                        <div class="text-sm text-gray-500 mb-2">Day Streak üî•</div>
                        <div class="text-xs text-gray-400">Level <span id="user-level">12</span> Learner</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Assistant Quick Access -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8 border-l-4 border-blue-500">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center">
                        <span class="text-white text-lg">ü§ñ</span>
                    </div>
                    <div>
                        <h3 class="font-bold text-gray-800">AI Learning Assistant</h3>
                        <p class="text-sm text-gray-600">Ask me anything about your studies!</p>
                    </div>
                </div>
                <button onclick="showAITutor()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                    Chat Now
                </button>
            </div>
            <div class="bg-gray-50 rounded-lg p-4">
                <p class="text-sm text-gray-700 italic">"Hi! I noticed you're working on calculus. Would you like me to explain derivatives in a simpler way?"</p>
            </div>
        </div>

        <!-- Advanced Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl shadow-lg p-6 card-hover relative overflow-hidden">
                <div class="absolute top-0 right-0 w-20 h-20 bg-green-100 rounded-full -mr-10 -mt-10"></div>
                <div class="relative z-10">
                    <div class="flex items-center justify-between mb-3">
                        <div>
                            <p class="text-gray-500 text-sm">Courses Completed</p>
                            <p class="text-3xl font-bold text-green-600">12</p>
                            <p class="text-xs text-green-500">+2 this week</p>
                        </div>
                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                            <span class="text-2xl">‚úÖ</span>
                        </div>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-green-500 h-2 rounded-full" style="width: 75%"></div>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-lg p-6 card-hover relative overflow-hidden">
                <div class="absolute top-0 right-0 w-20 h-20 bg-blue-100 rounded-full -mr-10 -mt-10"></div>
                <div class="relative z-10">
                    <div class="flex items-center justify-between mb-3">
                        <div>
                            <p class="text-gray-500 text-sm">AI Accuracy Score</p>
                            <p class="text-3xl font-bold text-blue-600">94%</p>
                            <p class="text-xs text-blue-500">+5% improvement</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                            <span class="text-2xl">üéØ</span>
                        </div>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-blue-500 h-2 rounded-full" style="width: 94%"></div>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-lg p-6 card-hover relative overflow-hidden">
                <div class="absolute top-0 right-0 w-20 h-20 bg-purple-100 rounded-full -mr-10 -mt-10"></div>
                <div class="relative z-10">
                    <div class="flex items-center justify-between mb-3">
                        <div>
                            <p class="text-gray-500 text-sm">Study Time</p>
                            <p class="text-3xl font-bold text-purple-600">45.2h</p>
                            <p class="text-xs text-purple-500">8.5h this week</p>
                        </div>
                        <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                            <span class="text-2xl">‚è∞</span>
                        </div>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-purple-500 h-2 rounded-full" style="width: 68%"></div>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-xl shadow-lg p-6 card-hover relative overflow-hidden">
                <div class="absolute top-0 right-0 w-20 h-20 bg-yellow-100 rounded-full -mr-10 -mt-10"></div>
                <div class="relative z-10">
                    <div class="flex items-center justify-between mb-3">
                        <div>
                            <p class="text-gray-500 text-sm">Skill Mastery</p>
                            <p class="text-3xl font-bold text-yellow-600">8/12</p>
                            <p class="text-xs text-yellow-500">2 new skills</p>
                        </div>
                        <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                            <span class="text-2xl">üèÜ</span>
                        </div>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-yellow-500 h-2 rounded-full" style="width: 67%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Advanced Dashboard Layout -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Column - Main Content -->
            <div class="lg:col-span-2 space-y-6">
                <!-- AI-Powered Course Recommendations -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3">
                            <h3 class="text-xl font-bold text-gray-800">AI-Recommended Learning Path</h3>
                            <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">Personalized</span>
                        </div>
                        <button onclick="showAllCourses()" class="text-blue-600 hover:text-blue-700 text-sm font-medium">View All</button>
                    </div>
                    <div class="space-y-4" id="courses-container">
                        <!-- Courses will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Interactive Code Playground -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3">
                            <h3 class="text-xl font-bold text-gray-800">Code Playground</h3>
                            <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Live</span>
                        </div>
                        <button onclick="showCodeLab()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium">Open Lab</button>
                    </div>
                    <div class="bg-gray-900 rounded-lg p-4 code-editor">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex space-x-2">
                                <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                                <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                                <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                            </div>
                            <span class="text-gray-400 text-xs">Python Playground</span>
                        </div>
                        <div class="syntax-highlight">
                            <div class="text-gray-400 text-sm mb-2"># AI-Generated Learning Exercise</div>
                            <div><span class="keyword">def</span> <span class="text-blue-400">fibonacci</span>(n):</div>
                            <div class="ml-4"><span class="keyword">if</span> n <= 1:</div>
                            <div class="ml-8"><span class="keyword">return</span> n</div>
                            <div class="ml-4"><span class="keyword">return</span> fibonacci(n-1) + fibonacci(n-2)</div>
                        </div>
                        <button class="mt-3 bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">Run Code</button>
                    </div>
                </div>

                <!-- Enhanced Quiz Section -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3">
                            <h3 class="text-xl font-bold text-gray-800">Adaptive Quiz Challenge</h3>
                            <span class="bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded-full">AI-Powered</span>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="generateAndStartNewQuiz()" class="text-blue-600 hover:text-blue-700 text-sm font-medium">New Quiz</button>
                            <button onclick="showQuizStats()" class="text-gray-600 hover:text-gray-700 text-sm font-medium">Stats</button>
                        </div>
                    </div>
                    <div id="quiz-container">
                        <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-6">
                            <h4 class="font-semibold text-gray-800 mb-4" id="quiz-question">What is the capital of France?</h4>
                            <div class="space-y-3" id="quiz-options">
                                <!-- Quiz options will be populated by JavaScript -->
                            </div>
                            <div class="mt-4 flex justify-between items-center">
                                <div class="text-sm text-gray-600">Question <span id="current-q">1</span> of <span id="total-q">5</span></div>
                                <button id="next-quiz-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">Next Question</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Study Analytics Chart -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-bold text-gray-800">Learning Analytics</h3>
                        <select class="text-sm border border-gray-300 rounded-lg px-3 py-1">
                            <option>Last 7 days</option>
                            <option>Last 30 days</option>
                            <option>Last 3 months</option>
                        </select>
                    </div>
                    <div class="h-64">
                        <canvas id="studyChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Right Column - Advanced Sidebar -->
            <div class="space-y-6">
                <!-- AI Study Assistant -->
                <div class="bg-gradient-to-br from-blue-50 to-purple-50 rounded-xl shadow-lg p-6 border border-blue-100">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-800">ü§ñ AI Study Buddy</h3>
                        <div class="w-2 h-2 bg-green-400 rounded-full pulse-dot"></div>
                    </div>
                    <div class="space-y-3">
                        <div class="bg-white/60 rounded-lg p-3">
                            <p class="text-sm text-gray-700">"Based on your progress, I recommend focusing on calculus derivatives next!"</p>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="showAITutor()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white text-xs py-2 rounded-lg transition-colors">Chat</button>
                            <button onclick="getAIRecommendation()" class="flex-1 bg-purple-600 hover:bg-purple-700 text-white text-xs py-2 rounded-lg transition-colors">Tips</button>
                        </div>
                    </div>
                </div>

                <!-- Live Activity Feed -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-800">üì° Live Activity</h3>
                        <button class="text-xs text-blue-600 hover:text-blue-700">View All</button>
                    </div>
                    <div class="space-y-3" id="live-updates">
                        <!-- Live updates will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Smart Schedule -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-800">üìÖ Smart Schedule</h3>
                        <button onclick="optimizeSchedule()" class="text-xs bg-green-100 text-green-700 px-2 py-1 rounded-full hover:bg-green-200 transition-colors">Optimize</button>
                    </div>
                    <div class="space-y-3" id="schedule-container">
                        <!-- Schedule will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Skill Progress Radar -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">üéØ Skill Mastery</h3>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-600">Mathematics</span>
                            <div class="flex items-center space-x-2">
                                <div class="w-20 bg-gray-200 rounded-full h-2">
                                    <div class="bg-blue-500 h-2 rounded-full" style="width: 85%"></div>
                                </div>
                                <span class="text-xs text-gray-500">85%</span>
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-600">Science</span>
                            <div class="flex items-center space-x-2">
                                <div class="w-20 bg-gray-200 rounded-full h-2">
                                    <div class="bg-green-500 h-2 rounded-full" style="width: 72%"></div>
                                </div>
                                <span class="text-xs text-gray-500">72%</span>
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-600">Programming</span>
                            <div class="flex items-center space-x-2">
                                <div class="w-20 bg-gray-200 rounded-full h-2">
                                    <div class="bg-purple-500 h-2 rounded-full" style="width: 68%"></div>
                                </div>
                                <span class="text-xs text-gray-500">68%</span>
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-600">History</span>
                            <div class="flex items-center space-x-2">
                                <div class="w-20 bg-gray-200 rounded-full h-2">
                                    <div class="bg-yellow-500 h-2 rounded-full" style="width: 91%"></div>
                                </div>
                                <span class="text-xs text-gray-500">91%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Achievement Showcase -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-800">üèÜ Achievements</h3>
                        <button onclick="showAllAchievements()" class="text-xs text-blue-600 hover:text-blue-700">View All</button>
                    </div>
                    <div class="space-y-3" id="achievements-container">
                        <!-- Achievements will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Study Groups -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-bold text-gray-800">üë• Study Groups</h3>
                        <button onclick="showStudyGroups()" class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full hover:bg-blue-200 transition-colors">Join</button>
                    </div>
                    <div class="space-y-3">
                        <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer">
                            <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-xs font-bold">M</div>
                            <div class="flex-1">
                                <p class="text-sm font-medium text-gray-800">Math Study Group</p>
                                <p class="text-xs text-gray-500">5 members online</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer">
                            <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white text-xs font-bold">C</div>
                            <div class="flex-1">
                                <p class="text-sm font-medium text-gray-800">Coding Bootcamp</p>
                                <p class="text-xs text-gray-500">12 members online</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Floating Action Button -->
        <div class="fixed bottom-6 right-6 z-50">
            <button onclick="showAITutor()" class="w-14 h-14 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-full shadow-lg hover:shadow-xl transition-all transform hover:scale-110 flex items-center justify-center neon-glow">
                <span class="text-xl">ü§ñ</span>
            </button>
        </div>
    </main>

    <!-- Modal Container -->
    <div id="modal-container" class="hidden fixed inset-0 bg-black bg-opacity-50 modal-backdrop z-50 flex items-center justify-center p-4">
        <!-- Modal content will be inserted here -->
    </div>

    <script>
        // Advanced Authentication & State Management
        let isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
        let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
        let currentView = 'dashboard';
        let studyChart = null;

        // Advanced Course Data with AI Recommendations
        const courses = [
            { 
                id: 1, 
                title: "Advanced Mathematics", 
                progress: 75, 
                nextLesson: "Calculus Derivatives", 
                subject: "Math", 
                color: "blue",
                difficulty: "Advanced",
                estimatedTime: "45 min",
                aiRecommended: true,
                skills: ["Problem Solving", "Analytical Thinking"],
                instructor: "Dr. Sarah Chen"
            },
            { 
                id: 2, 
                title: "Machine Learning Basics", 
                progress: 30, 
                nextLesson: "Neural Networks Intro", 
                subject: "AI/ML", 
                color: "purple",
                difficulty: "Intermediate",
                estimatedTime: "60 min",
                aiRecommended: true,
                skills: ["Data Analysis", "Python Programming"],
                instructor: "Prof. Alex Kumar"
            },
            { 
                id: 3, 
                title: "World History", 
                progress: 60, 
                nextLesson: "Industrial Revolution", 
                subject: "History", 
                color: "green",
                difficulty: "Beginner",
                estimatedTime: "30 min",
                aiRecommended: false,
                skills: ["Critical Thinking", "Research"],
                instructor: "Ms. Emily Rodriguez"
            },
            { 
                id: 4, 
                title: "Python Programming", 
                progress: 85, 
                nextLesson: "Object-Oriented Programming", 
                subject: "Programming", 
                color: "yellow",
                difficulty: "Intermediate",
                estimatedTime: "50 min",
                aiRecommended: true,
                skills: ["Coding", "Logic Building"],
                instructor: "Mr. David Park"
            }
        ];

        // Dynamic quiz question bank organized by subject
        const quizBank = {
            math: [
                { question: "What is 15 √ó 8?", options: ["120", "125", "115", "130"], correct: 0 },
                { question: "What is the square root of 144?", options: ["11", "12", "13", "14"], correct: 1 },
                { question: "What is 25% of 80?", options: ["15", "20", "25", "30"], correct: 1 },
                { question: "What is 7¬≥ (7 cubed)?", options: ["343", "49", "21", "147"], correct: 0 },
                { question: "What is the value of œÄ (pi) rounded to 2 decimal places?", options: ["3.14", "3.15", "3.16", "3.13"], correct: 0 },
                { question: "If x + 5 = 12, what is x?", options: ["6", "7", "8", "9"], correct: 1 },
                { question: "What is 2/3 as a decimal?", options: ["0.66", "0.67", "0.666...", "0.65"], correct: 2 }
            ],
            science: [
                { question: "What is the chemical symbol for gold?", options: ["Go", "Gd", "Au", "Ag"], correct: 2 },
                { question: "How many bones are in the human body?", options: ["206", "208", "210", "204"], correct: 0 },
                { question: "What gas do plants absorb from the atmosphere?", options: ["Oxygen", "Nitrogen", "Carbon Dioxide", "Hydrogen"], correct: 2 },
                { question: "What is the hardest natural substance?", options: ["Gold", "Iron", "Diamond", "Platinum"], correct: 2 },
                { question: "What is the speed of light?", options: ["300,000 km/s", "150,000 km/s", "450,000 km/s", "200,000 km/s"], correct: 0 },
                { question: "Which organ produces insulin?", options: ["Liver", "Pancreas", "Kidney", "Heart"], correct: 1 },
                { question: "What is the most abundant gas in Earth's atmosphere?", options: ["Oxygen", "Carbon Dioxide", "Nitrogen", "Argon"], correct: 2 }
            ],
            history: [
                { question: "Who wrote 'Romeo and Juliet'?", options: ["Charles Dickens", "William Shakespeare", "Jane Austen", "Mark Twain"], correct: 1 },
                { question: "In which year did World War II end?", options: ["1944", "1945", "1946", "1947"], correct: 1 },
                { question: "Who was the first President of the United States?", options: ["Thomas Jefferson", "John Adams", "George Washington", "Benjamin Franklin"], correct: 2 },
                { question: "Which ancient wonder was located in Alexandria?", options: ["Hanging Gardens", "Lighthouse", "Colossus", "Mausoleum"], correct: 1 },
                { question: "The Berlin Wall fell in which year?", options: ["1987", "1988", "1989", "1990"], correct: 2 },
                { question: "Who painted the Mona Lisa?", options: ["Michelangelo", "Leonardo da Vinci", "Raphael", "Donatello"], correct: 1 },
                { question: "Which empire was ruled by Julius Caesar?", options: ["Greek", "Roman", "Persian", "Egyptian"], correct: 1 }
            ],
            geography: [
                { question: "What is the capital of France?", options: ["London", "Berlin", "Paris", "Madrid"], correct: 2 },
                { question: "Which is the largest ocean?", options: ["Atlantic", "Indian", "Arctic", "Pacific"], correct: 3 },
                { question: "What is the longest river in the world?", options: ["Amazon", "Nile", "Mississippi", "Yangtze"], correct: 1 },
                { question: "Which country has the most time zones?", options: ["Russia", "USA", "China", "Canada"], correct: 0 },
                { question: "What is the smallest country in the world?", options: ["Monaco", "Vatican City", "San Marino", "Liechtenstein"], correct: 1 },
                { question: "Which mountain range contains Mount Everest?", options: ["Andes", "Alps", "Himalayas", "Rockies"], correct: 2 },
                { question: "Which desert is the largest in the world?", options: ["Sahara", "Gobi", "Antarctic", "Arabian"], correct: 2 }
            ],
            general: [
                { question: "Which planet is closest to the Sun?", options: ["Venus", "Mercury", "Earth", "Mars"], correct: 1 },
                { question: "How many minutes are in a full day?", options: ["1440", "1400", "1480", "1420"], correct: 0 },
                { question: "What is the largest mammal?", options: ["Elephant", "Blue Whale", "Giraffe", "Hippopotamus"], correct: 1 },
                { question: "Which language has the most native speakers?", options: ["English", "Spanish", "Mandarin", "Hindi"], correct: 2 },
                { question: "What is the currency of Japan?", options: ["Yuan", "Won", "Yen", "Rupee"], correct: 2 },
                { question: "How many sides does a hexagon have?", options: ["5", "6", "7", "8"], correct: 1 },
                { question: "What is the boiling point of water in Celsius?", options: ["90¬∞C", "95¬∞C", "100¬∞C", "105¬∞C"], correct: 2 }
            ]
        };

        // Quiz state management
        let currentQuizSet = [];
        let quizStats = JSON.parse(localStorage.getItem('quizStats')) || {
            totalQuizzes: 0,
            totalCorrect: 0,
            subjectStats: {},
            recentScores: [],
            streak: 0,
            lastQuizDate: null
        };

        let currentQuiz = 0;
        let quizScore = 0;
        let selectedAnswer = null;

        // Advanced Navigation System
        function showDashboard() {
            currentView = 'dashboard';
            initDashboard();
        }

        function showAITutor() {
            currentView = 'ai-tutor';
            showModal(`
                <div class="bg-white rounded-2xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center">
                                <span class="text-white text-xl">ü§ñ</span>
                            </div>
                            <div>
                                <h2 class="text-2xl font-bold text-gray-800">AI Learning Assistant</h2>
                                <p class="text-gray-600">Your personal study companion</p>
                            </div>
                        </div>
                        <button onclick="hideModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                    </div>
                    
                    <div class="bg-gray-50 rounded-xl p-6 mb-6 h-96 overflow-y-auto" id="chat-messages">
                        <div class="space-y-4">
                            <div class="flex items-start space-x-3">
                                <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                                    <span class="text-white text-sm">ü§ñ</span>
                                </div>
                                <div class="bg-white rounded-lg p-3 max-w-xs">
                                    <p class="text-sm">Hi! I'm your AI tutor. I can help you with math, science, programming, and more. What would you like to learn today?</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex space-x-3">
                        <input type="text" id="chat-input" placeholder="Ask me anything about your studies..." class="flex-1 border border-gray-300 rounded-lg px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <button onclick="sendMessage()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">Send</button>
                    </div>
                    
                    <div class="mt-4 flex flex-wrap gap-2">
                        <button onclick="askAI('Explain calculus derivatives')" class="text-xs bg-blue-100 text-blue-700 px-3 py-2 rounded-full hover:bg-blue-200 transition-colors">Explain calculus derivatives</button>
                        <button onclick="askAI('Help with Python loops')" class="text-xs bg-green-100 text-green-700 px-3 py-2 rounded-full hover:bg-green-200 transition-colors">Help with Python loops</button>
                        <button onclick="askAI('Study plan for exams')" class="text-xs bg-purple-100 text-purple-700 px-3 py-2 rounded-full hover:bg-purple-200 transition-colors">Study plan for exams</button>
                    </div>
                </div>
            `);
        }

        function showCodeLab() {
            currentView = 'code-lab';
            showModal(`
                <div class="bg-white rounded-2xl p-8 max-w-6xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">üß™ Interactive Code Laboratory</h2>
                        <button onclick="hideModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div>
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="font-semibold text-gray-800">Code Editor</h3>
                                <select id="language-select" class="text-sm border border-gray-300 rounded px-2 py-1">
                                    <option value="python">Python</option>
                                    <option value="javascript">JavaScript</option>
                                    <option value="html">HTML/CSS</option>
                                </select>
                            </div>
                            <div class="bg-gray-900 rounded-lg p-4 code-editor h-96">
                                <textarea id="code-editor" class="w-full h-full bg-transparent text-green-400 font-mono text-sm resize-none outline-none" placeholder="# Write your code here...
def hello_world():
    print('Hello, World!')
    
hello_world()"></textarea>
                            </div>
                            <div class="flex space-x-2 mt-3">
                                <button onclick="runCode()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium">‚ñ∂ Run Code</button>
                                <button onclick="clearCode()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm font-medium">Clear</button>
                                <button onclick="getAIHelp()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium">ü§ñ AI Help</button>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="font-semibold text-gray-800 mb-3">Output</h3>
                            <div class="bg-black rounded-lg p-4 h-96 overflow-y-auto">
                                <div id="code-output" class="text-green-400 font-mono text-sm whitespace-pre-wrap">Ready to run your code...</div>
                            </div>
                            
                            <div class="mt-4">
                                <h4 class="font-semibold text-gray-800 mb-2">Quick Challenges</h4>
                                <div class="space-y-2">
                                    <button onclick="loadChallenge('fibonacci')" class="w-full text-left p-3 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors">
                                        <div class="font-medium text-blue-800">Fibonacci Sequence</div>
                                        <div class="text-sm text-blue-600">Generate the first 10 Fibonacci numbers</div>
                                    </button>
                                    <button onclick="loadChallenge('palindrome')" class="w-full text-left p-3 bg-green-50 rounded-lg hover:bg-green-100 transition-colors">
                                        <div class="font-medium text-green-800">Palindrome Checker</div>
                                        <div class="text-sm text-green-600">Check if a string is a palindrome</div>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `);
        }

        function showAnalytics() {
            currentView = 'analytics';
            showModal(`
                <div class="bg-white rounded-2xl p-8 max-w-6xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">üìä Learning Analytics Dashboard</h2>
                        <button onclick="hideModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl p-6">
                            <div class="text-3xl font-bold text-blue-600 mb-2">94%</div>
                            <div class="text-sm text-blue-800">Overall Performance</div>
                            <div class="text-xs text-blue-600 mt-1">+12% from last month</div>
                        </div>
                        <div class="bg-gradient-to-r from-green-50 to-green-100 rounded-xl p-6">
                            <div class="text-3xl font-bold text-green-600 mb-2">127h</div>
                            <div class="text-sm text-green-800">Total Study Time</div>
                            <div class="text-xs text-green-600 mt-1">+8.5h this week</div>
                        </div>
                        <div class="bg-gradient-to-r from-purple-50 to-purple-100 rounded-xl p-6">
                            <div class="text-3xl font-bold text-purple-600 mb-2">15</div>
                            <div class="text-sm text-purple-800">Skills Mastered</div>
                            <div class="text-xs text-purple-600 mt-1">3 new this month</div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-gray-50 rounded-xl p-6">
                            <h3 class="font-bold text-gray-800 mb-4">Weekly Progress</h3>
                            <canvas id="weeklyChart" class="w-full h-64"></canvas>
                        </div>
                        <div class="bg-gray-50 rounded-xl p-6">
                            <h3 class="font-bold text-gray-800 mb-4">Subject Performance</h3>
                            <canvas id="subjectChart" class="w-full h-64"></canvas>
                        </div>
                    </div>
                </div>
            `);
            
            // Initialize charts after modal is shown
            setTimeout(() => {
                initAnalyticsCharts();
            }, 100);
        }

        function showStudyGroups() {
            currentView = 'study-groups';
            showModal(`
                <div class="bg-white rounded-2xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">üë• Study Groups</h2>
                        <button onclick="hideModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="border border-gray-200 rounded-xl p-6 hover:shadow-lg transition-shadow">
                            <div class="flex items-center space-x-3 mb-4">
                                <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold">M</div>
                                <div>
                                    <h3 class="font-bold text-gray-800">Advanced Mathematics</h3>
                                    <p class="text-sm text-gray-600">15 members ‚Ä¢ Active now</p>
                                </div>
                            </div>
                            <p class="text-sm text-gray-700 mb-4">Collaborative problem-solving sessions for calculus and linear algebra students.</p>
                            <div class="flex space-x-2">
                                <button class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg text-sm font-medium">Join Group</button>
                                <button class="px-4 py-2 border border-gray-300 rounded-lg text-sm text-gray-600 hover:bg-gray-50">Preview</button>
                            </div>
                        </div>
                        
                        <div class="border border-gray-200 rounded-xl p-6 hover:shadow-lg transition-shadow">
                            <div class="flex items-center space-x-3 mb-4">
                                <div class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center text-white font-bold">C</div>
                                <div>
                                    <h3 class="font-bold text-gray-800">Coding Bootcamp</h3>
                                    <p class="text-sm text-gray-600">28 members ‚Ä¢ 12 online</p>
                                </div>
                            </div>
                            <p class="text-sm text-gray-700 mb-4">Learn programming together with daily challenges and peer code reviews.</p>
                            <div class="flex space-x-2">
                                <button class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg text-sm font-medium">Join Group</button>
                                <button class="px-4 py-2 border border-gray-300 rounded-lg text-sm text-gray-600 hover:bg-gray-50">Preview</button>
                            </div>
                        </div>
                    </div>
                </div>
            `);
        }

        // Initialize the dashboard
        function initDashboard() {
            // Update welcome message with user name
            if (currentUser) {
                document.getElementById('welcome-message').textContent = `Welcome back, ${currentUser.name}! üëã`;
                document.getElementById('user-name-header').textContent = currentUser.name;
                document.getElementById('user-avatar').textContent = currentUser.name.charAt(0).toUpperCase();
            }
            
            renderCourses();
            
            // Generate initial quiz if none exists
            if (currentQuizSet.length === 0) {
                generateNewQuiz();
            }
            renderQuiz();
            
            renderLiveUpdates();
            renderSchedule();
            renderAchievements();
            startLiveUpdates();
            updateDashboardStats();
            initStudyChart();
        }

        function renderCourses() {
            const container = document.getElementById('courses-container');
            container.innerHTML = courses.slice(0, 3).map(course => `
                <div class="border border-gray-200 rounded-xl p-6 hover:border-${course.color}-300 hover:shadow-lg transition-all cursor-pointer card-hover relative overflow-hidden">
                    ${course.aiRecommended ? '<div class="absolute top-2 right-2 bg-blue-500 text-white text-xs px-2 py-1 rounded-full">AI Pick</div>' : ''}
                    
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-2">
                                <h4 class="font-bold text-gray-800 text-lg">${course.title}</h4>
                                <span class="text-xs bg-${course.color}-100 text-${course.color}-700 px-2 py-1 rounded-full">${course.difficulty}</span>
                            </div>
                            <p class="text-sm text-gray-600 mb-2">üë®‚Äçüè´ ${course.instructor}</p>
                            <p class="text-sm text-gray-700 mb-3">üìö Next: ${course.nextLesson}</p>
                            
                            <div class="flex items-center space-x-4 text-xs text-gray-500 mb-4">
                                <span>‚è±Ô∏è ${course.estimatedTime}</span>
                                <span>üìä ${course.subject}</span>
                            </div>
                            
                            <div class="flex flex-wrap gap-1 mb-4">
                                ${course.skills.map(skill => `<span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded-full">${skill}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex-1 mr-4">
                            <div class="bg-gray-200 rounded-full h-3">
                                <div class="bg-${course.color}-500 h-3 rounded-full progress-bar" style="width: ${course.progress}%"></div>
                            </div>
                        </div>
                        <span class="text-sm font-bold text-gray-700">${course.progress}%</span>
                    </div>
                    
                    <div class="flex space-x-2">
                        <button onclick="continueCourse(${course.id})" class="flex-1 bg-${course.color}-600 hover:bg-${course.color}-700 text-white py-2 px-4 rounded-lg text-sm font-medium transition-colors">
                            Continue Learning
                        </button>
                        <button onclick="showCourseDetails(${course.id})" class="px-4 py-2 border border-gray-300 rounded-lg text-sm text-gray-600 hover:bg-gray-50 transition-colors">
                            Details
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Generate a new random quiz set
        function generateNewQuiz() {
            const subjects = Object.keys(quizBank);
            const selectedQuestions = [];
            
            // Get 5 random questions from different subjects
            for (let i = 0; i < 5; i++) {
                const randomSubject = subjects[Math.floor(Math.random() * subjects.length)];
                const subjectQuestions = quizBank[randomSubject];
                const randomQuestion = subjectQuestions[Math.floor(Math.random() * subjectQuestions.length)];
                
                // Add subject info to question
                const questionWithSubject = {
                    ...randomQuestion,
                    subject: randomSubject,
                    id: `${randomSubject}_${Date.now()}_${i}`
                };
                
                selectedQuestions.push(questionWithSubject);
            }
            
            currentQuizSet = selectedQuestions;
            currentQuiz = 0;
            quizScore = 0;
            selectedAnswer = null;
        }

        function renderQuiz() {
            if (currentQuiz >= currentQuizSet.length) {
                const percentage = Math.round((quizScore / currentQuizSet.length) * 100);
                updateQuizStats(quizScore, currentQuizSet.length);
                
                document.getElementById('quiz-container').innerHTML = `
                    <div class="bg-gradient-to-r from-green-50 to-blue-50 rounded-lg p-6 text-center">
                        <div class="text-4xl mb-4">${percentage >= 80 ? 'üéâ' : percentage >= 60 ? 'üëç' : 'üìö'}</div>
                        <h4 class="font-bold text-xl text-gray-800 mb-2">Quiz Complete!</h4>
                        <p class="text-gray-600 mb-2">You scored ${quizScore} out of ${currentQuizSet.length} (${percentage}%)</p>
                        <div class="text-sm text-gray-500 mb-4">
                            ${percentage >= 80 ? 'Excellent work! üåü' : percentage >= 60 ? 'Good job! Keep practicing! üí™' : 'Keep studying and try again! üìñ'}
                        </div>
                        <div class="flex gap-3 justify-center">
                            <button onclick="generateAndStartNewQuiz()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium">New Quiz</button>
                            <button onclick="showQuizStats()" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg font-medium">View Stats</button>
                        </div>
                    </div>
                `;
                return;
            }

            const quiz = currentQuizSet[currentQuiz];
            const subjectColors = {
                math: 'blue',
                science: 'green',
                history: 'purple',
                geography: 'orange',
                general: 'gray'
            };
            
            const subjectEmojis = {
                math: 'üî¢',
                science: 'üî¨',
                history: 'üìö',
                geography: 'üåç',
                general: 'üß†'
            };

            document.getElementById('quiz-question').textContent = quiz.question;
            document.getElementById('current-q').textContent = currentQuiz + 1;
            document.getElementById('total-q').textContent = currentQuizSet.length;
            
            // Add subject indicator
            const quizContainer = document.getElementById('quiz-container');
            const subjectBadge = `
                <div class="flex items-center justify-between mb-4">
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-${subjectColors[quiz.subject]}-100 text-${subjectColors[quiz.subject]}-800">
                        ${subjectEmojis[quiz.subject]} ${quiz.subject.charAt(0).toUpperCase() + quiz.subject.slice(1)}
                    </span>
                    <span class="text-sm text-gray-500">Score: ${quizScore}/${currentQuiz}</span>
                </div>
            `;
            
            const optionsContainer = document.getElementById('quiz-options');
            optionsContainer.innerHTML = quiz.options.map((option, index) => `
                <button onclick="selectAnswer(${index})" class="quiz-option w-full text-left p-3 border border-gray-200 rounded-lg hover:border-blue-300 hover:bg-blue-50 transition-colors" data-index="${index}">
                    ${String.fromCharCode(65 + index)}. ${option}
                </button>
            `).join('');

            // Add subject badge before question
            const questionElement = document.getElementById('quiz-question');
            if (!questionElement.previousElementSibling || !questionElement.previousElementSibling.classList.contains('subject-badge')) {
                const badgeDiv = document.createElement('div');
                badgeDiv.className = 'subject-badge flex items-center justify-between mb-4';
                badgeDiv.innerHTML = `
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-${subjectColors[quiz.subject]}-100 text-${subjectColors[quiz.subject]}-800">
                        ${subjectEmojis[quiz.subject]} ${quiz.subject.charAt(0).toUpperCase() + quiz.subject.slice(1)}
                    </span>
                    <span class="text-sm text-gray-500">Score: ${quizScore}/${currentQuiz}</span>
                `;
                questionElement.parentNode.insertBefore(badgeDiv, questionElement);
            } else {
                questionElement.previousElementSibling.innerHTML = `
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-${subjectColors[quiz.subject]}-100 text-${subjectColors[quiz.subject]}-800">
                        ${subjectEmojis[quiz.subject]} ${quiz.subject.charAt(0).toUpperCase() + quiz.subject.slice(1)}
                    </span>
                    <span class="text-sm text-gray-500">Score: ${quizScore}/${currentQuiz}</span>
                `;
            }

            selectedAnswer = null;
        }

        function selectAnswer(index) {
            selectedAnswer = index;
            document.querySelectorAll('.quiz-option').forEach((btn, i) => {
                btn.classList.remove('bg-blue-100', 'border-blue-400');
                if (i === index) {
                    btn.classList.add('bg-blue-100', 'border-blue-400');
                }
            });
        }

        function nextQuestion() {
            if (selectedAnswer === null) {
                alert('Please select an answer first!');
                return;
            }

            const currentQuestion = currentQuizSet[currentQuiz];
            const isCorrect = selectedAnswer === currentQuestion.correct;
            
            if (isCorrect) {
                quizScore++;
                // Show correct feedback
                showAnswerFeedback(true, currentQuestion.options[currentQuestion.correct]);
            } else {
                // Show incorrect feedback
                showAnswerFeedback(false, currentQuestion.options[currentQuestion.correct]);
            }

            setTimeout(() => {
                currentQuiz++;
                renderQuiz();
            }, 1500);
        }

        function showAnswerFeedback(isCorrect, correctAnswer) {
            const selectedButton = document.querySelector(`[data-index="${selectedAnswer}"]`);
            const correctButton = document.querySelector(`[data-index="${currentQuizSet[currentQuiz].correct}"]`);
            
            if (isCorrect) {
                selectedButton.classList.add('bg-green-100', 'border-green-400', 'text-green-800');
                selectedButton.innerHTML += ' ‚úÖ';
            } else {
                selectedButton.classList.add('bg-red-100', 'border-red-400', 'text-red-800');
                selectedButton.innerHTML += ' ‚ùå';
                correctButton.classList.add('bg-green-100', 'border-green-400', 'text-green-800');
                correctButton.innerHTML += ' ‚úÖ';
            }
            
            // Disable all buttons
            document.querySelectorAll('.quiz-option').forEach(btn => {
                btn.disabled = true;
                btn.classList.add('cursor-not-allowed');
            });
        }

        function updateQuizStats(score, total) {
            const today = new Date().toDateString();
            const percentage = Math.round((score / total) * 100);
            
            quizStats.totalQuizzes++;
            quizStats.totalCorrect += score;
            quizStats.recentScores.push(percentage);
            
            // Keep only last 10 scores
            if (quizStats.recentScores.length > 10) {
                quizStats.recentScores.shift();
            }
            
            // Update streak
            if (quizStats.lastQuizDate === today) {
                // Same day, don't update streak
            } else if (percentage >= 60) {
                quizStats.streak++;
            } else {
                quizStats.streak = 0;
            }
            
            quizStats.lastQuizDate = today;
            
            // Update subject stats
            currentQuizSet.forEach((question, index) => {
                const subject = question.subject;
                if (!quizStats.subjectStats[subject]) {
                    quizStats.subjectStats[subject] = { correct: 0, total: 0 };
                }
                quizStats.subjectStats[subject].total++;
                if (index < score) {
                    quizStats.subjectStats[subject].correct++;
                }
            });
            
            localStorage.setItem('quizStats', JSON.stringify(quizStats));
            updateDashboardStats();
        }

        function updateDashboardStats() {
            const avgScore = quizStats.totalQuizzes > 0 ? 
                Math.round((quizStats.totalCorrect / (quizStats.totalQuizzes * 5)) * 100) : 87;
            
            document.querySelector('.text-blue-600').textContent = avgScore + '%';
            document.getElementById('streak-counter').textContent = quizStats.streak || 7;
        }

        function generateAndStartNewQuiz() {
            generateNewQuiz();
            renderQuiz();
        }

        function showQuizStats() {
            const avgScore = quizStats.totalQuizzes > 0 ? 
                Math.round((quizStats.totalCorrect / (quizStats.totalQuizzes * 5)) * 100) : 0;
            
            const subjectStatsHtml = Object.entries(quizStats.subjectStats).map(([subject, stats]) => {
                const percentage = stats.total > 0 ? Math.round((stats.correct / stats.total) * 100) : 0;
                const subjectEmojis = {
                    math: 'üî¢',
                    science: 'üî¨', 
                    history: 'üìö',
                    geography: 'üåç',
                    general: 'üß†'
                };
                return `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <span class="flex items-center">
                            <span class="mr-2">${subjectEmojis[subject]}</span>
                            ${subject.charAt(0).toUpperCase() + subject.slice(1)}
                        </span>
                        <span class="font-medium">${percentage}% (${stats.correct}/${stats.total})</span>
                    </div>
                `;
            }).join('');

            document.getElementById('quiz-container').innerHTML = `
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-6">
                    <h4 class="font-bold text-xl text-gray-800 mb-6 text-center">üìä Your Quiz Statistics</h4>
                    
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="text-center p-4 bg-white rounded-lg">
                            <div class="text-2xl font-bold text-blue-600">${quizStats.totalQuizzes}</div>
                            <div class="text-sm text-gray-600">Total Quizzes</div>
                        </div>
                        <div class="text-center p-4 bg-white rounded-lg">
                            <div class="text-2xl font-bold text-green-600">${avgScore}%</div>
                            <div class="text-sm text-gray-600">Average Score</div>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h5 class="font-semibold text-gray-800 mb-3">Subject Performance</h5>
                        <div class="space-y-2">
                            ${subjectStatsHtml || '<p class="text-gray-500 text-center">No subject data yet</p>'}
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h5 class="font-semibold text-gray-800 mb-3">Recent Scores</h5>
                        <div class="flex flex-wrap gap-2">
                            ${quizStats.recentScores.map(score => `
                                <span class="px-3 py-1 rounded-full text-sm ${score >= 80 ? 'bg-green-100 text-green-800' : score >= 60 ? 'bg-yellow-100 text-yellow-800' : 'bg-red-100 text-red-800'}">${score}%</span>
                            `).join('') || '<p class="text-gray-500">No recent scores</p>'}
                        </div>
                    </div>
                    
                    <div class="text-center">
                        <button onclick="generateAndStartNewQuiz()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium">Start New Quiz</button>
                    </div>
                </div>
            `;
        }

        function renderLiveUpdates() {
            const updates = [
                { time: "2 min ago", text: "New Chemistry lab simulation available", type: "new" },
                { time: "5 min ago", text: "Math quiz results published", type: "update" },
                { time: "12 min ago", text: "Sarah completed World History Chapter 5", type: "achievement" },
                { time: "18 min ago", text: "New study group formed for Physics", type: "social" }
            ];

            const container = document.getElementById('live-updates');
            container.innerHTML = updates.map(update => `
                <div class="flex items-start space-x-3 p-3 bg-gray-50 rounded-lg">
                    <div class="w-2 h-2 bg-green-400 rounded-full mt-2 pulse-dot"></div>
                    <div class="flex-1">
                        <p class="text-sm text-gray-800">${update.text}</p>
                        <p class="text-xs text-gray-500">${update.time}</p>
                    </div>
                </div>
            `).join('');
        }

        function renderSchedule() {
            const schedule = [
                { time: "10:00 AM", subject: "Mathematics", type: "Live Class" },
                { time: "2:00 PM", subject: "Chemistry", type: "Lab Session" },
                { time: "4:00 PM", subject: "History", type: "Study Group" },
                { time: "6:00 PM", subject: "Physics", type: "Quiz Due" }
            ];

            const container = document.getElementById('schedule-container');
            container.innerHTML = schedule.map(item => `
                <div class="flex items-center justify-between p-3 border-l-4 border-blue-400 bg-blue-50 rounded-r-lg">
                    <div>
                        <p class="font-medium text-gray-800">${item.subject}</p>
                        <p class="text-sm text-gray-600">${item.type}</p>
                    </div>
                    <span class="text-sm font-medium text-blue-600">${item.time}</span>
                </div>
            `).join('');
        }

        function renderAchievements() {
            const achievements = [
                { title: "Quiz Master", description: "Scored 90%+ on 5 quizzes", icon: "üèÖ" },
                { title: "Study Streak", description: "7 days in a row", icon: "üî•" },
                { title: "Fast Learner", description: "Completed 3 courses this month", icon: "‚ö°" }
            ];

            const container = document.getElementById('achievements-container');
            container.innerHTML = achievements.map(achievement => `
                <div class="flex items-center space-x-3 p-3 bg-yellow-50 rounded-lg">
                    <span class="text-2xl">${achievement.icon}</span>
                    <div>
                        <p class="font-medium text-gray-800">${achievement.title}</p>
                        <p class="text-sm text-gray-600">${achievement.description}</p>
                    </div>
                </div>
            `).join('');
        }

        function startLiveUpdates() {
            // Simulate real-time updates
            setInterval(() => {
                const updates = [
                    "New assignment posted in Biology",
                    "Emma just completed Advanced Physics",
                    "Study reminder: Chemistry test tomorrow",
                    "New discussion started in Math forum",
                    "Weekly progress report available"
                ];
                
                const randomUpdate = updates[Math.floor(Math.random() * updates.length)];
                const container = document.getElementById('live-updates');
                const newUpdate = document.createElement('div');
                newUpdate.className = 'flex items-start space-x-3 p-3 bg-green-50 rounded-lg';
                newUpdate.innerHTML = `
                    <div class="w-2 h-2 bg-green-400 rounded-full mt-2 pulse-dot"></div>
                    <div class="flex-1">
                        <p class="text-sm text-gray-800">${randomUpdate}</p>
                        <p class="text-xs text-gray-500">Just now</p>
                    </div>
                `;
                container.insertBefore(newUpdate, container.firstChild);
                
                // Keep only the latest 4 updates
                if (container.children.length > 4) {
                    container.removeChild(container.lastChild);
                }
            }, 15000); // Update every 15 seconds
        }

        // Event listeners
        document.getElementById('next-quiz-btn').addEventListener('click', nextQuestion);

        // Authentication functions
        function showLoginForm() {
            document.body.innerHTML = `
                <div class="min-h-screen gradient-bg flex items-center justify-center px-6">
                    <div class="max-w-md w-full">
                        <div class="bg-white rounded-2xl shadow-2xl p-8">
                            <div class="text-center mb-8">
                                <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl flex items-center justify-center mx-auto mb-4">
                                    <span class="text-3xl">üéì</span>
                                </div>
                                <h2 class="text-3xl font-bold text-gray-800">Welcome Back!</h2>
                                <p class="text-gray-600 mt-2">Sign in to continue your learning journey</p>
                            </div>
                            
                            <form id="loginForm" class="space-y-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                                    <input type="email" id="loginEmail" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Enter your email">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                                    <input type="password" id="loginPassword" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Enter your password">
                                </div>
                                
                                <div class="flex items-center justify-between">
                                    <label class="flex items-center">
                                        <input type="checkbox" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                        <span class="ml-2 text-sm text-gray-600">Remember me</span>
                                    </label>
                                    <a href="#" class="text-sm text-blue-600 hover:text-blue-700">Forgot password?</a>
                                </div>
                                
                                <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition-all transform hover:scale-105">
                                    Sign In
                                </button>
                            </form>
                            
                            <div class="mt-6 text-center">
                                <p class="text-gray-600">Don't have an account? 
                                    <button onclick="showSignupForm()" class="text-blue-600 hover:text-blue-700 font-medium">Sign up here</button>
                                </p>
                            </div>
                            
                            <div class="mt-6">
                                <div class="relative">
                                    <div class="absolute inset-0 flex items-center">
                                        <div class="w-full border-t border-gray-300"></div>
                                    </div>
                                    <div class="relative flex justify-center text-sm">
                                        <span class="px-2 bg-white text-gray-500">Or continue with</span>
                                    </div>
                                </div>
                                
                                <div class="mt-6 grid grid-cols-2 gap-3">
                                    <button class="w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-lg shadow-sm bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                        <span class="mr-2">üìß</span> Google
                                    </button>
                                    <button class="w-full inline-flex justify-center py-2 px-4 border border-gray-300 rounded-lg shadow-sm bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                        <span class="mr-2">üìò</span> Facebook
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
        }

        function showSignupForm() {
            document.body.innerHTML = `
                <div class="min-h-screen gradient-bg flex items-center justify-center px-6">
                    <div class="max-w-md w-full">
                        <div class="bg-white rounded-2xl shadow-2xl p-8">
                            <div class="text-center mb-8">
                                <div class="w-16 h-16 bg-gradient-to-r from-green-500 to-blue-600 rounded-xl flex items-center justify-center mx-auto mb-4">
                                    <span class="text-3xl">üöÄ</span>
                                </div>
                                <h2 class="text-3xl font-bold text-gray-800">Join Smart Learning Hub</h2>
                                <p class="text-gray-600 mt-2">Create your account and start learning today</p>
                            </div>
                            
                            <form id="signupForm" class="space-y-6">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">First Name</label>
                                        <input type="text" id="firstName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="John">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Last Name</label>
                                        <input type="text" id="lastName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Doe">
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                                    <input type="email" id="signupEmail" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="john@example.com">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Grade Level</label>
                                    <select id="gradeLevel" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                                        <option value="">Select your grade</option>
                                        <option value="6">Grade 6</option>
                                        <option value="7">Grade 7</option>
                                        <option value="8">Grade 8</option>
                                        <option value="9">Grade 9</option>
                                        <option value="10">Grade 10</option>
                                        <option value="11">Grade 11</option>
                                        <option value="12">Grade 12</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                                    <input type="password" id="signupPassword" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Create a strong password">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Confirm Password</label>
                                    <input type="password" id="confirmPassword" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" placeholder="Confirm your password">
                                </div>
                                
                                <div class="flex items-center">
                                    <input type="checkbox" id="agreeTerms" required class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                                    <label for="agreeTerms" class="ml-2 text-sm text-gray-600">
                                        I agree to the <a href="#" class="text-blue-600 hover:text-blue-700">Terms of Service</a> and <a href="#" class="text-blue-600 hover:text-blue-700">Privacy Policy</a>
                                    </label>
                                </div>
                                
                                <button type="submit" class="w-full bg-gradient-to-r from-green-600 to-blue-600 text-white py-3 rounded-lg font-semibold hover:from-green-700 hover:to-blue-700 transition-all transform hover:scale-105">
                                    Create Account
                                </button>
                            </form>
                            
                            <div class="mt-6 text-center">
                                <p class="text-gray-600">Already have an account? 
                                    <button onclick="showLoginForm()" class="text-blue-600 hover:text-blue-700 font-medium">Sign in here</button>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('signupForm').addEventListener('submit', handleSignup);
        }

        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Simple validation (in real app, this would be server-side)
            if (email && password) {
                const user = {
                    name: email.split('@')[0].charAt(0).toUpperCase() + email.split('@')[0].slice(1),
                    email: email,
                    grade: '10',
                    joinDate: new Date().toISOString()
                };
                
                localStorage.setItem('isLoggedIn', 'true');
                localStorage.setItem('currentUser', JSON.stringify(user));
                
                showSuccessMessage('Welcome back! Redirecting to dashboard...', () => {
                    location.reload();
                });
            }
        }

        function handleSignup(e) {
            e.preventDefault();
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const email = document.getElementById('signupEmail').value;
            const grade = document.getElementById('gradeLevel').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (password !== confirmPassword) {
                alert('Passwords do not match!');
                return;
            }
            
            if (password.length < 6) {
                alert('Password must be at least 6 characters long!');
                return;
            }
            
            const user = {
                name: firstName + ' ' + lastName,
                email: email,
                grade: grade,
                joinDate: new Date().toISOString()
            };
            
            localStorage.setItem('isLoggedIn', 'true');
            localStorage.setItem('currentUser', JSON.stringify(user));
            
            showSuccessMessage('Account created successfully! Welcome to Smart Learning Hub!', () => {
                location.reload();
            });
        }

        function logout() {
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('currentUser');
            showSuccessMessage('Logged out successfully!', () => {
                location.reload();
            });
        }

        function showSuccessMessage(message, callback) {
            const overlay = document.createElement('div');
            overlay.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            overlay.innerHTML = `
                <div class="bg-white rounded-xl p-8 max-w-sm mx-4 text-center">
                    <div class="text-4xl mb-4">‚úÖ</div>
                    <p class="text-gray-800 font-medium">${message}</p>
                </div>
            `;
            document.body.appendChild(overlay);
            
            setTimeout(() => {
                document.body.removeChild(overlay);
                if (callback) callback();
            }, 2000);
        }

        // Advanced Utility Functions
        function showModal(content) {
            const modal = document.getElementById('modal-container');
            modal.innerHTML = content;
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function hideModal() {
            const modal = document.getElementById('modal-container');
            modal.classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        function toggleUserMenu() {
            const menu = document.getElementById('user-menu');
            menu.classList.toggle('hidden');
        }

        function showNotifications() {
            showModal(`
                <div class="bg-white rounded-2xl p-8 max-w-md w-full">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-xl font-bold text-gray-800">üîî Notifications</h2>
                        <button onclick="hideModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                    </div>
                    <div class="space-y-4">
                        <div class="p-4 bg-blue-50 rounded-lg border-l-4 border-blue-400">
                            <p class="font-medium text-blue-800">New AI recommendation available!</p>
                            <p class="text-sm text-blue-600 mt-1">Based on your progress, try the advanced calculus module.</p>
                        </div>
                        <div class="p-4 bg-green-50 rounded-lg border-l-4 border-green-400">
                            <p class="font-medium text-green-800">Quiz completed successfully!</p>
                            <p class="text-sm text-green-600 mt-1">You scored 95% on the Python basics quiz.</p>
                        </div>
                        <div class="p-4 bg-yellow-50 rounded-lg border-l-4 border-yellow-400">
                            <p class="font-medium text-yellow-800">Study reminder</p>
                            <p class="text-sm text-yellow-600 mt-1">Don't forget your scheduled math session at 3 PM.</p>
                        </div>
                    </div>
                </div>
            `);
        }

        // AI Chat Functions
        function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (!message) return;
            
            addChatMessage(message, 'user');
            input.value = '';
            
            // Simulate AI thinking
            setTimeout(() => {
                const responses = [
                    "Great question! Let me break that down for you step by step...",
                    "I can help you with that! Here's what you need to know...",
                    "That's an interesting topic. Let me explain it in simple terms...",
                    "Perfect! I have some great resources and explanations for this..."
                ];
                const response = responses[Math.floor(Math.random() * responses.length)];
                addChatMessage(response, 'ai');
            }, 1000);
        }

        function askAI(question) {
            document.getElementById('chat-input').value = question;
            sendMessage();
        }

        function addChatMessage(message, sender) {
            const container = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'flex items-start space-x-3 slide-in';
            
            if (sender === 'user') {
                messageDiv.innerHTML = `
                    <div class="w-8 h-8 bg-gray-500 rounded-full flex items-center justify-center">
                        <span class="text-white text-sm">üë§</span>
                    </div>
                    <div class="bg-blue-100 rounded-lg p-3 max-w-xs">
                        <p class="text-sm">${message}</p>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                        <span class="text-white text-sm">ü§ñ</span>
                    </div>
                    <div class="bg-white rounded-lg p-3 max-w-xs">
                        <p class="text-sm typing-animation">${message}</p>
                    </div>
                `;
            }
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        // Code Lab Functions
        function runCode() {
            const code = document.getElementById('code-editor').value;
            const output = document.getElementById('code-output');
            
            // Simulate code execution
            output.textContent = 'Running code...\n';
            
            setTimeout(() => {
                if (code.includes('print') || code.includes('console.log')) {
                    output.textContent += 'Hello, World!\n';
                    output.textContent += 'Code executed successfully! ‚úÖ\n';
                } else {
                    output.textContent += 'Code executed successfully! ‚úÖ\n';
                    output.textContent += 'No output to display.\n';
                }
            }, 1000);
        }

        function clearCode() {
            document.getElementById('code-editor').value = '';
            document.getElementById('code-output').textContent = 'Ready to run your code...';
        }

        function getAIHelp() {
            const code = document.getElementById('code-editor').value;
            const output = document.getElementById('code-output');
            
            output.textContent = 'ü§ñ AI analyzing your code...\n';
            
            setTimeout(() => {
                output.textContent += 'AI Suggestions:\n';
                output.textContent += '‚Ä¢ Consider adding comments to explain your logic\n';
                output.textContent += '‚Ä¢ Your code structure looks good!\n';
                output.textContent += '‚Ä¢ Try adding error handling for robustness\n';
            }, 1500);
        }

        function loadChallenge(type) {
            const editor = document.getElementById('code-editor');
            
            if (type === 'fibonacci') {
                editor.value = `# Fibonacci Sequence Challenge
# Generate the first 10 Fibonacci numbers

def fibonacci(n):
    # Your code here
    pass

# Test your function
for i in range(10):
    print(f"F({i}) = {fibonacci(i)}")`;
            } else if (type === 'palindrome') {
                editor.value = `# Palindrome Checker Challenge
# Check if a string reads the same forwards and backwards

def is_palindrome(text):
    # Your code here
    pass

# Test cases
test_words = ["racecar", "hello", "madam", "python"]
for word in test_words:
    result = is_palindrome(word)
    print(f"'{word}' is {'a palindrome' if result else 'not a palindrome'}")`;
            }
        }

        // Chart Functions
        function initStudyChart() {
            const ctx = document.getElementById('studyChart');
            if (!ctx) return;
            
            if (studyChart) {
                studyChart.destroy();
            }
            
            studyChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Study Hours',
                        data: [2.5, 3.2, 1.8, 4.1, 2.9, 3.7, 2.2],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        function initAnalyticsCharts() {
            // Weekly Progress Chart
            const weeklyCtx = document.getElementById('weeklyChart');
            if (weeklyCtx) {
                new Chart(weeklyCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                        datasets: [{
                            label: 'Progress Score',
                            data: [78, 85, 92, 94],
                            backgroundColor: 'rgba(59, 130, 246, 0.8)',
                            borderRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } }
                    }
                });
            }
            
            // Subject Performance Chart
            const subjectCtx = document.getElementById('subjectChart');
            if (subjectCtx) {
                new Chart(subjectCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Math', 'Science', 'Programming', 'History'],
                        datasets: [{
                            data: [85, 72, 68, 91],
                            backgroundColor: [
                                '#3b82f6',
                                '#10b981',
                                '#8b5cf6',
                                '#f59e0b'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
        }

        // Additional Functions
        function continueCourse(courseId) {
            const course = courses.find(c => c.id === courseId);
            showSuccessMessage(`Starting ${course.title} - ${course.nextLesson}`, () => {
                // Simulate course progress
                course.progress = Math.min(100, course.progress + 5);
                renderCourses();
            });
        }

        function showCourseDetails(courseId) {
            const course = courses.find(c => c.id === courseId);
            showModal(`
                <div class="bg-white rounded-2xl p-8 max-w-2xl w-full">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">${course.title}</h2>
                        <button onclick="hideModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                    </div>
                    <div class="space-y-4">
                        <p><strong>Instructor:</strong> ${course.instructor}</p>
                        <p><strong>Difficulty:</strong> ${course.difficulty}</p>
                        <p><strong>Estimated Time:</strong> ${course.estimatedTime}</p>
                        <p><strong>Skills:</strong> ${course.skills.join(', ')}</p>
                        <p><strong>Progress:</strong> ${course.progress}%</p>
                        <div class="w-full bg-gray-200 rounded-full h-3">
                            <div class="bg-${course.color}-500 h-3 rounded-full" style="width: ${course.progress}%"></div>
                        </div>
                    </div>
                    <div class="mt-6 flex space-x-3">
                        <button onclick="continueCourse(${course.id}); hideModal();" class="flex-1 bg-${course.color}-600 hover:bg-${course.color}-700 text-white py-2 px-4 rounded-lg font-medium">Continue Learning</button>
                        <button onclick="hideModal()" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-600 hover:bg-gray-50">Close</button>
                    </div>
                </div>
            `);
        }

        function getAIRecommendation() {
            const recommendations = [
                "Focus on calculus derivatives - you're 75% through advanced math!",
                "Try the new machine learning module - it matches your programming skills!",
                "Review chemistry basics before moving to advanced topics.",
                "Your history performance is excellent - consider the advanced course!"
            ];
            
            const recommendation = recommendations[Math.floor(Math.random() * recommendations.length)];
            showSuccessMessage(`AI Recommendation: ${recommendation}`);
        }

        function optimizeSchedule() {
            showSuccessMessage("Schedule optimized! Study sessions rearranged for maximum efficiency.", () => {
                renderSchedule();
            });
        }

        function showAllCourses() {
            showModal(`
                <div class="bg-white rounded-2xl p-8 max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">All Courses</h2>
                        <button onclick="hideModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        ${courses.map(course => `
                            <div class="border border-gray-200 rounded-xl p-6 hover:shadow-lg transition-shadow">
                                <h3 class="font-bold text-gray-800 mb-2">${course.title}</h3>
                                <p class="text-sm text-gray-600 mb-4">${course.instructor}</p>
                                <div class="w-full bg-gray-200 rounded-full h-2 mb-4">
                                    <div class="bg-${course.color}-500 h-2 rounded-full" style="width: ${course.progress}%"></div>
                                </div>
                                <button onclick="continueCourse(${course.id})" class="w-full bg-${course.color}-600 hover:bg-${course.color}-700 text-white py-2 px-4 rounded-lg text-sm font-medium">Continue</button>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `);
        }

        function showAllAchievements() {
            showModal(`
                <div class="bg-white rounded-2xl p-8 max-w-3xl w-full">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">üèÜ All Achievements</h2>
                        <button onclick="hideModal()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                            <div class="text-2xl mb-2">üèÖ</div>
                            <h3 class="font-bold text-yellow-800">Quiz Master</h3>
                            <p class="text-sm text-yellow-600">Scored 90%+ on 5 consecutive quizzes</p>
                        </div>
                        <div class="p-4 bg-blue-50 rounded-lg border border-blue-200">
                            <div class="text-2xl mb-2">üî•</div>
                            <h3 class="font-bold text-blue-800">Study Streak</h3>
                            <p class="text-sm text-blue-600">7 days of continuous learning</p>
                        </div>
                        <div class="p-4 bg-green-50 rounded-lg border border-green-200">
                            <div class="text-2xl mb-2">‚ö°</div>
                            <h3 class="font-bold text-green-800">Fast Learner</h3>
                            <p class="text-sm text-green-600">Completed 3 courses this month</p>
                        </div>
                        <div class="p-4 bg-purple-50 rounded-lg border border-purple-200">
                            <div class="text-2xl mb-2">üéØ</div>
                            <h3 class="font-bold text-purple-800">Goal Crusher</h3>
                            <p class="text-sm text-purple-600">Met weekly study goals for 4 weeks</p>
                        </div>
                    </div>
                </div>
            `);
        }

        // Close user menu when clicking outside
        document.addEventListener('click', function(event) {
            const userMenu = document.getElementById('user-menu');
            const userButton = event.target.closest('button[onclick="toggleUserMenu()"]');
            
            if (!userButton && userMenu && !userMenu.contains(event.target)) {
                userMenu.classList.add('hidden');
            }
        });

        // Chat input enter key support
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Enter' && event.target.id === 'chat-input') {
                sendMessage();
            }
        });

        // Check authentication status and initialize
        function initApp() {
            if (!isLoggedIn) {
                showLoginForm();
            } else {
                initDashboard();
            }
        }

        // Initialize dashboard when page loads
        initApp();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98c00f5c013fa5d3',t:'MTc2MDAzNTc5MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
